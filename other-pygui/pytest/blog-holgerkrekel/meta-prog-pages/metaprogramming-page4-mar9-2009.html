<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>metaprogramming | metaprogramming and politics | Page 4</title>
<link rel="pingback" href="http://holgerkrekel.net/xmlrpc.php">
<meta name="google-site-verification" content="AcZhUPE5jxZKf3FnzFTBpBf37euoXeeAlFlJxzqABqI">
		<script src="metaprogramming-page4-mar9-2009_files/remote-login.php" type="text/javascript"></script>
		<script type="text/javascript">
		/* <![CDATA[ */
			if ( 'function' === typeof WPRemoteLogin ) {
				document.cookie = "wordpress_test_cookie=test; path=/";
				if ( document.cookie.match( /(;|^)\s*wordpress_test_cookie\=/ ) ) {
					WPRemoteLogin();
				}
			}
		/* ]]> */
		</script>
		<link rel="alternate" type="application/rss+xml" title="metaprogramming and politics » Feed" href="http://holgerkrekel.net/feed/">
<link rel="alternate" type="application/rss+xml" title="metaprogramming and politics » Comments Feed" href="http://holgerkrekel.net/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="metaprogramming and politics » metaprogramming Category Feed" href="http://holgerkrekel.net/category/metaprogramming/feed/">
<script type="text/javascript">
/* <![CDATA[ */
function addLoadEvent(func){var oldonload=window.onload;if(typeof window.onload!='function'){window.onload=func;}else{window.onload=function(){oldonload();func();}}}
/* ]]> */
</script>
<link rel="stylesheet" id="all-css-0" href="metaprogramming-page4-mar9-2009_files/a.css" type="text/css" media="all">
<!--[if IE 6]>
<link rel='stylesheet' id='journalist-ie6-css'  href='https://s0.wp.com/wp-content/themes/pub/journalist/ie6.css?m=1270837707g&#038;ver=4.2-RC4-32277' type='text/css' media='all' />
<![endif]-->
<link rel="stylesheet" id="all-css-2" href="metaprogramming-page4-mar9-2009_files/a_002.css" type="text/css" media="all">
<link rel="stylesheet" id="print-css-3" href="metaprogramming-page4-mar9-2009_files/global-print.css" type="text/css" media="print">
<link rel="stylesheet" id="all-css-4" href="metaprogramming-page4-mar9-2009_files/global.css" type="text/css" media="all">
<script type="text/javascript">
/* <![CDATA[ */
var LoggedOutFollow = {"invalid_email":"Your subscription did not succeed, please try again with a valid email address."};
/* ]]> */
</script>
<script type="text/javascript" src="metaprogramming-page4-mar9-2009_files/a_002"></script><style type="text/css"></style>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://tetamap.wordpress.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://s1.wp.com/wp-includes/wlwmanifest.xml"> 
<meta name="generator" content="WordPress.com">
<link rel="shortcut icon" type="image/x-icon" href="http://1.gravatar.com/blavatar/dbedfd22b9c524039edad5aa658c7e40?s=16" sizes="16x16">
<link rel="icon" type="image/x-icon" href="http://1.gravatar.com/blavatar/dbedfd22b9c524039edad5aa658c7e40?s=16" sizes="16x16">
<link rel="apple-touch-icon-precomposed" href="http://1.gravatar.com/blavatar/b3a31bdc09d8a9d15ba87f69d34ece75?s=114">
<link rel="openid.server" href="http://tetamap.wordpress.com/?openidserver=1">
<link rel="openid.delegate" href="http://tetamap.wordpress.com/">
<link rel="search" type="application/opensearchdescription+xml" href="http://holgerkrekel.net/osd.xml" title="metaprogramming and politics">
<link rel="search" type="application/opensearchdescription+xml" href="https://wordpress.com/opensearch.xml" title="WordPress.com">
	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
		<style type="text/css">
			.recentcomments a {
				display: inline !important;
				padding: 0 !important;
				margin: 0 !important;
			}

			table.recentcommentsavatartop img.avatar, table.recentcommentsavatarend img.avatar {
				border: 0px;
				margin: 0;
			}

			table.recentcommentsavatartop a, table.recentcommentsavatarend a {
				border: 0px !important;
				background-color: transparent !important;
			}

			td.recentcommentsavatarend, td.recentcommentsavatartop {
				padding: 0px 0px 1px 0px;
				margin: 0px;
			}

			td.recentcommentstextend {
				border: none !important;
				padding: 0px 0px 2px 10px;
			}

			.rtl td.recentcommentstextend {
				padding: 0px 10px 2px 0px;
			}

			td.recentcommentstexttop {
				border: none;
				padding: 0px 0px 0px 10px;
			}

			.rtl td.recentcommentstexttop {
				padding: 0px 10px 0px 0px;
			}
		</style>
		<style type="text/css">
.widget_twitter li {
	word-wrap: break-word;
}
</style>
<meta name="application-name" content="metaprogramming and politics"><meta name="msapplication-window" content="width=device-width;height=device-height"><meta name="msapplication-tooltip" content="Decentralize. Take the red pill."><meta name="msapplication-task" content="name=Subscribe;action-uri=http://holgerkrekel.net/feed/;icon-uri=http://1.gravatar.com/blavatar/dbedfd22b9c524039edad5aa658c7e40?s=16"><meta name="msapplication-task" content="name=Sign up for a free blog;action-uri=http://wordpress.com/signup/;icon-uri=http://s2.wp.com/i/favicon.ico"><meta name="msapplication-task" content="name=WordPress.com Support;action-uri=http://support.wordpress.com/;icon-uri=http://s2.wp.com/i/favicon.ico"><meta name="msapplication-task" content="name=WordPress.com Forums;action-uri=http://forums.wordpress.com/;icon-uri=http://s2.wp.com/i/favicon.ico"><meta name="title" content="Posts about metaprogramming on metaprogramming and politics">
<meta name="description" content="Posts about metaprogramming written by holger krekel">
<link href="metaprogramming-page4-mar9-2009_files/shCore.css" type="text/css" rel="stylesheet"><link href="metaprogramming-page4-mar9-2009_files/shThemeDefault.css" type="text/css" rel="stylesheet"><style type="text/css" id="syntaxhighlighteranchor"></style>
		<link rel="stylesheet" id="custom-css-css" type="text/css" href="metaprogramming-page4-mar9-2009_files/a_003.css">
		<link rel="stylesheet" type="text/css" id="gravatar-card-css" href="metaprogramming-page4-mar9-2009_files/hovercard.css"><link rel="stylesheet" type="text/css" id="gravatar-card-services-css" href="metaprogramming-page4-mar9-2009_files/services.css"><script type="text/javascript" src="http://en.gravatar.com/03671a05389885dc096868846a08c5f8.json?callback=Gravatar.fetch_profile_callback"></script></head>

<body data-twttr-rendered="true" class="archive paged category category-metaprogramming category-36279 paged-4 category-paged-4 mp6 typekit-enabled customizer-styles-applied highlander-enabled highlander-light infinite-scroll neverending">
<div id="container" class="group">

<h1><a href="http://holgerkrekel.net/">metaprogramming and politics</a></h1>
<div id="bubble"><p>Decentralize. Take the red pill.</p></div> <!-- erase this line if you want to turn the bubble off -->

<div id="content">

<h2 class="archive">Archive for the ‘<strong>metaprogramming</strong>’ Category</h2>

<div class="post-108 post type-post status-publish format-standard hentry category-metaprogramming">
	<h2 id="post-108"><a href="http://holgerkrekel.net/2009/03/09/openbossa-2009-opening/" rel="bookmark">Girls dancing, Openbossa 2009&nbsp;opening</a></h2>
			<p class="comments"><a href="http://holgerkrekel.net/2009/03/09/openbossa-2009-opening/#comments">leave a comment »</a></p>
	
	<div class="main">
		<p><a href="http://tetamap.files.wordpress.com/2009/03/opening.jpg"><img src="metaprogramming-page4-mar9-2009_files/opening.jpg" alt="openbossa dancing girls entering" title="openbossa dancing girls entering" class="alignleft size-medium wp-image-113" height="200" width="300"></a></p>
<p>So the third openbossa conference was just opened by a girls group 
playing an african rhythm, "marakatou" i was told.  Reminds me that i’d 
like to go out with people to some Drum and Base dancing, latest in 
Chicago.  The Openbossa conference is organised by INDT, Nokia’s 
brazillian Instituto Nokia de Tecnologia.  There is hardly anything that
 i would naturally associate with Finland here, though <span class="wp-smiley wp-emoji wp-emoji-smile" title=":)">:)</span>
 Well, in fact i don’t know very much of Finnland except for the nice 
people i’ve met so far and the Helsinki episode of Jim Jarmush’s "Night 
on Earth" movie.</p>
<p>Looking forward to some talks on the <a>Programme</a>, a number of 
which deal with Python.  Most attendants are male and come from Brazil, 
are working for or have some relation to Nokia.  Seems like kind of a 
Nokia developers meetup with invites to people they find interesting.  
Not the worst way to do a company outing. </p>
<p><a href="http://tetamap.files.wordpress.com/2009/03/girls1.jpg"><img src="metaprogramming-page4-mar9-2009_files/girls1.jpg" alt="Drumming girls at Openbossa" title="Drumming girls at Openbossa" class="alignleft size-full wp-image-109"></a></p>
	</div>

	<div class="meta group">
		<div class="signature">
			<p>Written by holger krekel <span class="edit"></span></p>
			<p>March 9, 2009 at 12:56 pm</p>
		</div>
		<div class="tags">
			<p>Posted in <a href="http://holgerkrekel.net/category/metaprogramming/" rel="category tag">metaprogramming</a></p>
					</div>
	</div>
</div>
<div class="post-101 post type-post status-publish format-standard hentry category-metaprogramming tag-metaprogramming tag-mobile tag-pypy">
	<h2 id="post-101"><a href="http://holgerkrekel.net/2009/03/04/mobiles-python-pypy-and-the-zone-vm/" rel="bookmark">Mobiles, Python, PyPy and the Zone&nbsp;VM</a></h2>
			<p class="comments"><a href="http://holgerkrekel.net/2009/03/04/mobiles-python-pypy-and-the-zone-vm/#comments">with 2 comments</a></p>
	
	<div class="main">
		<p>Next week i am going to <a class="reference external" href="http://www.bossaconference.indt.org/">OpenBossa</a>,
 a developer conference organised by Nokia’s research institute INDT in 
Brazil.  It’s about free and open source developments on small internet 
devices. I’ll be talking about <a class="reference external" href="http://www.bossaconference.indt.org/programme/programme">PyPy on Maemo</a>.
  In a nutshell, last year we made PyPy cross-compile for the 
Maemo/Linux platform. It turned out to use less RAM than CPython for 
virtually all Python objects.  It also starts new Python processes 
faster.  We have ideas to make it feasible to run hundreds of small 
isolated python processes on machines like my 190 Euro mobile or even 
cheaper ones.  I’ll post my slides with some more details next week and 
probably also twitter and blog a bit about my conference experiences.</p>
<p>To be honest, I’ve long ignored developments in the mobile device 
world.  Maybe mostly because I want to interact with people through open
 and freely available networks.  The way in which mobile networks are 
run for commercial purposes hampered my use of mobiles and my general 
interest.</p>
<p>But things seem to be changing rapidly. I appreciate that. There are 
more and more phones who connect both to mobile networks and to WLANs.  
The sudden possibility to use the internet whereever i have WLAN access 
opens up the device for me.  My <em>small</em> mobile has 128 MByte and a
 250 MHZ ARM CPU. It runs Python.  I can freely download tools from 
other people and use them.  Or I can hack something up or get in contact
 with developers.  I can use EMail, Internet radio, Twitter or browse 
the internet to begin with.  I find the software generally likeable 
although a bit shaky to install and control sometimes.</p>
<p>Well, I’d like to change various aspects of the User interface but 
they are probably quite hard-wired, e.g. text completion.  Nevertheless,
 i am thrilled by the overall technical opportunities.  This device 
could soon operate my working environment (it has a 16 Gig SD-RAM card 
for 15 Euros) and become a center piece of collaboration and 
communication. For this i’d like to trust the software and the people 
behind it.  So I look forward to meet up with developers more familiar 
with mobile worlds.  And to hang around Porto de Galinhas which i have 
been told is a beautiful place.</p>
<p>Of course, I am also curious to present and discuss how PyPy, with 
some more efforts, could provide a perfectly fitting Pythonic 
environment for mobiles.  My vision is to have a Python environment for 
driving all technical aspects of the phone and to instantly share 
scripts and apps with fellows worldwide.  All on the basis of a 
decentral network comprised of devices participating in it.  Similar to 
what Charles Stross describes in his books as the "Zone VM": a 
distributed virtual machine and environment.</p>
<p>cheers, holger</p>
	</div>

	<div class="meta group">
		<div class="signature">
			<p>Written by holger krekel <span class="edit"></span></p>
			<p>March 4, 2009 at 8:35 pm</p>
		</div>
		<div class="tags">
			<p>Posted in <a href="http://holgerkrekel.net/category/metaprogramming/" rel="category tag">metaprogramming</a></p>
			<p>Tagged with <a href="http://holgerkrekel.net/tag/metaprogramming/" rel="tag">metaprogramming</a>, <a href="http://holgerkrekel.net/tag/mobile/" rel="tag">mobile</a>, <a href="http://holgerkrekel.net/tag/pypy/" rel="tag">pypy</a></p>		</div>
	</div>
</div>
<div class="post-83 post type-post status-publish format-standard hentry category-metaprogramming category-testing tag-metaprogramming tag-mock tag-monkeypatch tag-plugin tag-testing">
	<h2 id="post-83"><a href="http://holgerkrekel.net/2009/03/03/monkeypatching-in-unit-tests-done-right/" rel="bookmark">Monkeypatching in unit tests, done&nbsp;right</a></h2>
			<p class="comments"><a href="http://holgerkrekel.net/2009/03/03/monkeypatching-in-unit-tests-done-right/#comments">with 16 comments</a></p>
	
	<div class="main">
		<p>[updated, thanks to marius].</p>
<p>I am currently preparing my <a class="reference external" href="http://us.pycon.org/2009/tutorials/schedule/2AM2/">testing</a> <a class="reference external" href="http://us.pycon.org/2009/tutorials/schedule/2PM2/">tutorials</a> for <a class="reference external" href="http://us.pycon.org/2009/about/">Pycon</a> and here is an example i’d lke to share already.</p>
<p>The problem: In a test function we want to patch an Environment 
variable and see if our application handles something related to it 
correctly. The direct approach for doing this in a test function might 
look like this:</p>
<div><div id="highlighter_830023" class="syntaxhighlighter  python"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="python keyword">def</code> <code class="python plain">test_envreading(</code><code class="python color1">self</code><code class="python plain">):</code></div><div class="line number2 index1 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">old </code><code class="python keyword">=</code> <code class="python plain">os.environ[</code><code class="python string">'ENV1'</code><code class="python plain">]</code></div><div class="line number3 index2 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">os.environ[</code><code class="python string">'ENV1'</code><code class="python plain">] </code><code class="python keyword">=</code> <code class="python string">'myval'</code></div><div class="line number4 index3 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">try</code><code class="python plain">:</code></div><div class="line number5 index4 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">val </code><code class="python keyword">=</code> <code class="python plain">myapp().readenv()</code></div><div class="line number6 index5 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">assert</code> <code class="python plain">val </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python string">"myval"</code></div><div class="line number7 index6 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">finally</code><code class="python plain">:</code></div><div class="line number8 index7 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">os.environ[</code><code class="python string">'ENV1'</code><code class="python plain">] </code><code class="python keyword">=</code> <code class="python plain">old</code></div></div></td></tr></tbody></table></div></div>
<p>If we needed to do this several times for test functions we’d have a 
lot of repetetive boilerplatish code. The try-finally and undo-related 
code does not even take into account that <tt class="docutils literal"><span class="pre">ENV1</span></tt> might not have been set originally.</p>
<p>Most experienced people would use setup/teardown methods to get 
less-repetetive testing code. We might end up with something slightly 
more general like this:</p>
<div><div id="highlighter_310048" class="syntaxhighlighter  python"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="python keyword">def</code> <code class="python plain">setup_method(</code><code class="python color1">self</code><code class="python plain">, method):</code></div><div class="line number2 index1 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python color1">self</code><code class="python plain">._oldenv </code><code class="python keyword">=</code> <code class="python plain">os.environ.copy()</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="python keyword">def</code> <code class="python plain">teardown_method(</code><code class="python color1">self</code><code class="python plain">, method):</code></div><div class="line number5 index4 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">os.environ.clear()</code></div><div class="line number6 index5 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">os.environ.update(</code><code class="python color1">self</code><code class="python plain">._oldenv)</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="python keyword">def</code> <code class="python plain">test_envreading(</code><code class="python color1">self</code><code class="python plain">):</code></div><div class="line number9 index8 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">os.environ[</code><code class="python string">'ENV1'</code><code class="python plain">] </code><code class="python keyword">=</code> <code class="python string">"myval"</code></div><div class="line number10 index9 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">val </code><code class="python keyword">=</code> <code class="python plain">myapp().readenv()</code></div><div class="line number11 index10 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">assert</code> <code class="python plain">val </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python string">"myval"</code></div></div></td></tr></tbody></table></div></div>
<p>This avoids repetition of setup code but it scatters what belongs to 
the test function across three functions. All other functions in the 
Testcase class will get the service of a preserved environment although 
they might not need it. If i want to move away this testing function i 
will need to take care to copy the setup code as well. Or i start 
subclassing Test cases to share code. If we then start to need modifying
 other dicts or classes we have to add code in three places.</p>
<div id="monkeypatching-the-right-way" class="section">
<h1>Monkeypatching the right way</h1>
<p>Here is a version of the test function which uses pytest’s <cite>monkeypatch`</cite> plugin. The plugin does one thing: it provides a <tt class="docutils literal"><span class="pre">monkeypatch</span></tt> object for each test function that needs it. The resulting test function code then looks like this:</p>
<div><div id="highlighter_720757" class="syntaxhighlighter  python"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="python keyword">def</code> <code class="python plain">test_envreading(</code><code class="python color1">self</code><code class="python plain">, monkeypatch):</code></div><div class="line number2 index1 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">monkeypatch.setitem(os.environ, </code><code class="python string">'ENV1'</code><code class="python plain">, </code><code class="python string">'myval'</code><code class="python plain">)</code></div><div class="line number3 index2 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">val </code><code class="python keyword">=</code> <code class="python plain">myapp().readenv()</code></div><div class="line number4 index3 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">assert</code> <code class="python plain">val </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python string">"myval"</code></div></div></td></tr></tbody></table></div></div>
<p>Here <tt class="docutils literal"><span class="pre">monkeypatch.setitem()</span></tt> will memorize old settings and modify the environment. When the test function finishes the <tt class="docutils literal"><span class="pre">monkeypatch</span></tt>
 object restores the original setting. This test function is free to get
 moved across files. No other test function or code place is affected or
 required to change when it moves.</p>
<p>Let’s take a quick look at the “providing” side, i.e. the <a class="reference external" href="http://codespeak.net/svn/py/trunk/py/test/plugin/pytest_monkeypatch.py">pytest_monkeypatch.py</a> plugin which provides “Monkeypatch” instances to test functions. It makes use of <a class="reference external" href="http://tetamap.wordpress.com/2009/02/22/new-way-to-organize-python-test-code/">pytest’s new pyfuncarg protocol</a>.</p>
<p>The plugin itself is free to get refined and changed as well, without
 affecting the existing test code. The following 71 lines of code make 
up the plugin, including tests:</p>
<div><div id="highlighter_710519" class="syntaxhighlighter  python"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div><div class="line number66 index65 alt1">66</div><div class="line number67 index66 alt2">67</div><div class="line number68 index67 alt1">68</div><div class="line number69 index68 alt2">69</div><div class="line number70 index69 alt1">70</div><div class="line number71 index70 alt2">71</div><div class="line number72 index71 alt1">72</div><div class="line number73 index72 alt2">73</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="python keyword">class</code> <code class="python plain">MonkeypatchPlugin:</code></div><div class="line number2 index1 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments">""" setattr-monkeypatching with automatical reversal after test. """</code></div><div class="line number3 index2 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">def</code> <code class="python plain">pytest_pyfuncarg_monkeypatch(</code><code class="python color1">self</code><code class="python plain">, pyfuncitem):</code></div><div class="line number4 index3 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">monkeypatch </code><code class="python keyword">=</code> <code class="python plain">MonkeyPatch()</code></div><div class="line number5 index4 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">pyfuncitem.addfinalizer(monkeypatch.finalize)</code></div><div class="line number6 index5 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python plain">monkeypatch</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="python plain">notset </code><code class="python keyword">=</code> <code class="python functions">object</code><code class="python plain">()</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="python keyword">class</code> <code class="python plain">MonkeyPatch:</code></div><div class="line number11 index10 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">def</code> <code class="python plain">__init__(</code><code class="python color1">self</code><code class="python plain">):</code></div><div class="line number12 index11 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python color1">self</code><code class="python plain">._setattr </code><code class="python keyword">=</code> <code class="python plain">[]</code></div><div class="line number13 index12 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python color1">self</code><code class="python plain">._setitem </code><code class="python keyword">=</code> <code class="python plain">[]</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">def</code> <code class="python functions">setattr</code><code class="python plain">(</code><code class="python color1">self</code><code class="python plain">, obj, name, value):</code></div><div class="line number16 index15 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python color1">self</code><code class="python plain">._setattr.insert(</code><code class="python value">0</code><code class="python plain">, (obj, name, </code><code class="python functions">getattr</code><code class="python plain">(obj, name, notset)))</code></div><div class="line number17 index16 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">setattr</code><code class="python plain">(obj, name, value)</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">def</code> <code class="python plain">setitem(</code><code class="python color1">self</code><code class="python plain">, dictionary, name, value):</code></div><div class="line number20 index19 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python color1">self</code><code class="python plain">._setitem.insert(</code><code class="python value">0</code><code class="python plain">, (dictionary, name, dictionary.get(name, notset)))</code></div><div class="line number21 index20 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">dictionary[name] </code><code class="python keyword">=</code> <code class="python plain">value</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">def</code> <code class="python plain">finalize(</code><code class="python color1">self</code><code class="python plain">):</code></div><div class="line number24 index23 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">for</code> <code class="python plain">obj, name, value </code><code class="python keyword">in</code> <code class="python color1">self</code><code class="python plain">._setattr:</code></div><div class="line number25 index24 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">value </code><code class="python keyword">is</code> <code class="python keyword">not</code> <code class="python plain">notset:</code></div><div class="line number26 index25 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">setattr</code><code class="python plain">(obj, name, value)</code></div><div class="line number27 index26 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">else</code><code class="python plain">:</code></div><div class="line number28 index27 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">delattr</code><code class="python plain">(obj, name)</code></div><div class="line number29 index28 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">for</code> <code class="python plain">dictionary, name, value </code><code class="python keyword">in</code> <code class="python color1">self</code><code class="python plain">._setitem:</code></div><div class="line number30 index29 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">value </code><code class="python keyword">is</code> <code class="python plain">notset:</code></div><div class="line number31 index30 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">del</code> <code class="python plain">dictionary[name]</code></div><div class="line number32 index31 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">else</code><code class="python plain">:</code></div><div class="line number33 index32 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">dictionary[name] </code><code class="python keyword">=</code> <code class="python plain">value</code></div><div class="line number34 index33 alt1">&nbsp;</div><div class="line number35 index34 alt2">&nbsp;</div><div class="line number36 index35 alt1"><code class="python keyword">def</code> <code class="python plain">test_setattr():</code></div><div class="line number37 index36 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">class</code> <code class="python plain">A:</code></div><div class="line number38 index37 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">x </code><code class="python keyword">=</code> <code class="python value">1</code></div><div class="line number39 index38 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">monkeypatch </code><code class="python keyword">=</code> <code class="python plain">MonkeyPatch()</code></div><div class="line number40 index39 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">monkeypatch.</code><code class="python functions">setattr</code><code class="python plain">(A, </code><code class="python string">'x'</code><code class="python plain">, </code><code class="python value">2</code><code class="python plain">)</code></div><div class="line number41 index40 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">assert</code> <code class="python plain">A.x </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python value">2</code></div><div class="line number42 index41 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">monkeypatch.</code><code class="python functions">setattr</code><code class="python plain">(A, </code><code class="python string">'x'</code><code class="python plain">, </code><code class="python value">3</code><code class="python plain">)</code></div><div class="line number43 index42 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">assert</code> <code class="python plain">A.x </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python value">3</code></div><div class="line number44 index43 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">monkeypatch.finalize()</code></div><div class="line number45 index44 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">assert</code> <code class="python plain">A.x </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python value">1</code></div><div class="line number46 index45 alt1">&nbsp;</div><div class="line number47 index46 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">monkeypatch.</code><code class="python functions">setattr</code><code class="python plain">(A, </code><code class="python string">'y'</code><code class="python plain">, </code><code class="python value">3</code><code class="python plain">)</code></div><div class="line number48 index47 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">assert</code> <code class="python plain">A.y </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python value">3</code></div><div class="line number49 index48 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">monkeypatch.finalize()</code></div><div class="line number50 index49 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">assert</code> <code class="python keyword">not</code> <code class="python functions">hasattr</code><code class="python plain">(A, </code><code class="python string">'y'</code><code class="python plain">)</code></div><div class="line number51 index50 alt2">&nbsp;</div><div class="line number52 index51 alt1">&nbsp;</div><div class="line number53 index52 alt2"><code class="python keyword">def</code> <code class="python plain">test_setitem():</code></div><div class="line number54 index53 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">d </code><code class="python keyword">=</code> <code class="python plain">{</code><code class="python string">'x'</code><code class="python plain">: </code><code class="python value">1</code><code class="python plain">}</code></div><div class="line number55 index54 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">monkeypatch </code><code class="python keyword">=</code> <code class="python plain">MonkeyPatch()</code></div><div class="line number56 index55 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">monkeypatch.setitem(d, </code><code class="python string">'x'</code><code class="python plain">, </code><code class="python value">2</code><code class="python plain">)</code></div><div class="line number57 index56 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">monkeypatch.setitem(d, </code><code class="python string">'y'</code><code class="python plain">, </code><code class="python value">1700</code><code class="python plain">)</code></div><div class="line number58 index57 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">assert</code> <code class="python plain">d[</code><code class="python string">'x'</code><code class="python plain">] </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python value">2</code></div><div class="line number59 index58 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">assert</code> <code class="python plain">d[</code><code class="python string">'y'</code><code class="python plain">] </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python value">1700</code></div><div class="line number60 index59 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">monkeypatch.setitem(d, </code><code class="python string">'x'</code><code class="python plain">, </code><code class="python value">3</code><code class="python plain">)</code></div><div class="line number61 index60 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">assert</code> <code class="python plain">d[</code><code class="python string">'x'</code><code class="python plain">] </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python value">3</code></div><div class="line number62 index61 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">monkeypatch.finalize()</code></div><div class="line number63 index62 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">assert</code> <code class="python plain">d[</code><code class="python string">'x'</code><code class="python plain">] </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python value">1</code></div><div class="line number64 index63 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">assert</code> <code class="python string">'y'</code> <code class="python keyword">not</code> <code class="python keyword">in</code> <code class="python plain">d</code></div><div class="line number65 index64 alt2">&nbsp;</div><div class="line number66 index65 alt1"><code class="python keyword">def</code> <code class="python plain">test_monkeypatch_plugin(testdir):</code></div><div class="line number67 index66 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">sorter </code><code class="python keyword">=</code> <code class="python plain">testdir.inline_runsource(</code><code class="python comments">"""</code></div><div class="line number68 index67 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments">pytest_plugins = 'pytest_monkeypatch',</code></div><div class="line number69 index68 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments">def test_method(monkeypatch):</code></div><div class="line number70 index69 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments">assert monkeypatch.__class__.__name__ == "MonkeyPatch"</code></div><div class="line number71 index70 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments">"""</code><code class="python plain">)</code></div><div class="line number72 index71 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">res </code><code class="python keyword">=</code> <code class="python plain">sorter.countoutcomes()</code></div><div class="line number73 index72 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">assert</code> <code class="python functions">tuple</code><code class="python plain">(res) </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python plain">(</code><code class="python value">1</code><code class="python plain">, </code><code class="python value">0</code><code class="python plain">, </code><code class="python value">0</code><code class="python plain">), res</code></div></div></td></tr></tbody></table></div></div>
<p>I can also imagine some nice plugin which supports <strong>mock</strong> objects – patching methods with some preset behaviour or tracing calls between components.</p>
<p>have fun, holger</p>
</div>
	</div>

	<div class="meta group">
		<div class="signature">
			<p>Written by holger krekel <span class="edit"></span></p>
			<p>March 3, 2009 at 1:48 pm</p>
		</div>
		<div class="tags">
			<p>Posted in <a href="http://holgerkrekel.net/category/metaprogramming/" rel="category tag">metaprogramming</a>, <a href="http://holgerkrekel.net/category/testing/" rel="category tag">testing</a></p>
			<p>Tagged with <a href="http://holgerkrekel.net/tag/metaprogramming/" rel="tag">metaprogramming</a>, <a href="http://holgerkrekel.net/tag/mock/" rel="tag">mock</a>, <a href="http://holgerkrekel.net/tag/monkeypatch/" rel="tag">monkeypatch</a>, <a href="http://holgerkrekel.net/tag/plugin/" rel="tag">plugin</a>, <a href="http://holgerkrekel.net/tag/testing/" rel="tag">testing</a></p>		</div>
	</div>
</div>
<div class="post-71 post type-post status-publish format-standard hentry category-metaprogramming category-testing">
	<h2 id="post-71"><a href="http://holgerkrekel.net/2009/02/27/new-plugin-architecture-and-plugins-for-pytest/" rel="bookmark">New Plugin architecture and plugins for&nbsp;py.test</a></h2>
			<p class="comments"><a href="http://holgerkrekel.net/2009/02/27/new-plugin-architecture-and-plugins-for-pytest/#comments">with one comment</a></p>
	
	<div class="main">
		<p>I just merged the plugin branch and am very happy about it. Part of
 the effort was driven by moving core functionality to become a plugin: 
 Terminal reporting is now fully a plugin, contained in a <a class="reference external" href="http://codespeak.net/svn/py/trunk/py/test/plugin/pytest_terminal.py">single file</a> including tests.  It does it work solely by looking at <em>testing events</em>.  Plugins can also add new aspects to tests files – for example the <a class="reference external" href="http://codespeak.net/svn/py/trunk/py/test/plugin/pytest_restdoc.py">pytest_restdoc.py</a>
 plugin adds ReST syntax, referential integrity and URL checking for 
Text files. (I used it for checking my blog post and its links, btw).</p>
<p>Pytest’s good old <tt class="docutils literal"><span class="pre">conftest.py</span></tt>
 files are still useful: you can define project or directory specific 
settings, including which plugins to use.  For now, many old extensions 
should work unmodified, as exemplified by <a class="reference external" href="http://codespeak.net/pypy/">PyPy</a>‘s extensive <tt class="docutils literal"><span class="pre">conftest.py</span></tt>
 files.  It’s easy to port a conftest file to a plugin.  In fact, you 
can first define a local "ConftestPlugin" and later move it to become a 
cross-project one – a matter of renaming the file and the class, done!</p>
<p>To serve as guiding examples, I drafted some initial plugins and implemented neccessary hooks within py.test core.</p>
<ul class="simple">
<li><a class="reference external" href="http://codespeak.net/svn/py/trunk/py/test/plugin/pytest_unittest.py">pytest_unittest.py</a>: collects traditional <tt class="docutils literal"><span class="pre">unittest.py</span></tt> based tests.</li>
<li><a class="reference external" href="http://codespeak.net/svn/py/trunk/py/test/plugin/pytest_xfail.py">pytest_xfail.py</a>: marks tests as "expected to fail" and reports them specially.</li>
<li><a class="reference external" href="http://codespeak.net/svn/py/trunk/py/test/plugin/pytest_pocoo.py">pytest_pocoo.py</a>: supplying <tt class="docutils literal"><span class="pre">-P</span></tt> will send failures to <a class="reference external" href="http://paste.pocoo.org/">http://paste.pocoo.org</a> and report URLs to the terminal.</li>
</ul>
<p>If you wan’t to get a feel on how plugins are implemented, here is the <a class="reference external" href="http://codespeak.net/svn/py/trunk/py/test/plugin/pytest_eventlog.py">pytest_eventlog.py</a>
 plugin which adds a command line option to allow logging of all testing
 events. It’s instructive to look at how it’s done as well as the output
 because it shows which testing events are generated.</p>
<div><div id="highlighter_694493" class="syntaxhighlighter  python"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="python keyword">class</code> <code class="python plain">EventlogPlugin:</code></div><div class="line number2 index1 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments">""" log pytest events to a file. """</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">def</code> <code class="python plain">pytest_addoption(</code><code class="python color1">self</code><code class="python plain">, parser):</code></div><div class="line number5 index4 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">parser.addoption(</code><code class="python string">"--eventlog"</code><code class="python plain">, dest</code><code class="python keyword">=</code><code class="python string">"eventlog"</code><code class="python plain">,</code></div><div class="line number6 index5 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">help</code><code class="python keyword">=</code><code class="python string">"write all pytest events to the given file."</code><code class="python plain">)</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">def</code> <code class="python plain">pytest_configure(</code><code class="python color1">self</code><code class="python plain">, config):</code></div><div class="line number9 index8 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">eventlog </code><code class="python keyword">=</code> <code class="python plain">config.getvalue(</code><code class="python string">'eventlog'</code><code class="python plain">)</code></div><div class="line number10 index9 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">eventlog:</code></div><div class="line number11 index10 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python color1">self</code><code class="python plain">.eventlogfile </code><code class="python keyword">=</code> <code class="python functions">open</code><code class="python plain">(eventlog).</code><code class="python functions">open</code><code class="python plain">(</code><code class="python string">'w'</code><code class="python plain">)</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">def</code> <code class="python plain">pytest_unconfigure(</code><code class="python color1">self</code><code class="python plain">, config):</code></div><div class="line number14 index13 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python functions">hasattr</code><code class="python plain">(</code><code class="python color1">self</code><code class="python plain">, </code><code class="python string">'eventlogfile'</code><code class="python plain">):</code></div><div class="line number15 index14 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python color1">self</code><code class="python plain">.eventlogfile.close()</code></div><div class="line number16 index15 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">del</code> <code class="python color1">self</code><code class="python plain">.eventlogfile</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">def</code> <code class="python plain">pyevent(</code><code class="python color1">self</code><code class="python plain">, eventname, </code><code class="python keyword">*</code><code class="python plain">args, </code><code class="python keyword">*</code><code class="python keyword">*</code><code class="python plain">kwargs):</code></div><div class="line number19 index18 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python functions">hasattr</code><code class="python plain">(</code><code class="python color1">self</code><code class="python plain">, </code><code class="python string">'eventlogfile'</code><code class="python plain">):</code></div><div class="line number20 index19 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">print</code> <code class="python plain">&gt;&gt;</code><code class="python color1">self</code><code class="python plain">.eventlogfile, eventname, args, kwargs</code></div><div class="line number21 index20 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python color1">self</code><code class="python plain">.eventlogfile.flush()</code></div></div></td></tr></tbody></table></div></div>
<p>This plugin code is complete, except that the original <a class="reference external" href="http://codespeak.net/svn/py/trunk/py/test/plugin/pytest_eventlog.py">pytest_eventlog.py</a> file contains tests.  The eventlog plugin methods above are called in the following way:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">def</span> <span class="pre">pytest_addoption(self,</span> <span class="pre">parser)</span></tt> is called before<br>
commandline arguments are parsed.</li>
<li><tt class="docutils literal"><span class="pre">def</span> <span class="pre">pytest_configure(self,</span> <span class="pre">config)</span></tt> is called after parsing<br>
arguments and before any reporting, collection or running<br>
of tests takes place.</li>
<li><tt class="docutils literal"><span class="pre">def</span> <span class="pre">pytest_event(self,</span> <span class="pre">eventname,</span> <span class="pre">*args,</span> <span class="pre">**kwargs)</span></tt> is called<br>
for each testing event. Events have names and come with<br>
arguments which are supplied by the event producing site.</li>
<li><tt class="docutils literal"><span class="pre">def</span> <span class="pre">pytest_unconfigure(self,</span> <span class="pre">config)</span></tt> is called after<br>
all test items have been processed.</li>
</ul>
<p>If you want to start writing your own plugin, please use an svn checkout of:</p>
<blockquote><p>
<a class="reference external" href="http://codespeak.net/svn/py/trunk/">http://codespeak.net/svn/py/trunk/</a></p></blockquote>
<p>and activate it by e.g. <cite>python setup.py develop</cite>.</p>
<p>If you want to write a plugin named <cite>pytest_XYZ</cite>, you can tell pytest to use it by setting the environment variable <tt class="docutils literal"><span class="pre">PYTEST_PLUGINS=XYZ</span></tt> or by putting <tt class="docutils literal"><span class="pre">pytest_plugins</span> <span class="pre">=</span> <span class="pre">'xyz'</span></tt> into a test module or <tt class="docutils literal"><span class="pre">conftest.py</span></tt> file.</p>
<p>A good way to contribute is to copy an existing plugin file to your 
home dir and put it somewhere into your PYTHONPATH. py.test will use 
your version instead of the default one and you can play with it untill 
you are happy (and see to also add some tests showing the new 
behaviour).</p>
<p>If you have questions or problems, you are invited to post here or to the <a class="reference external" href="http://codespeak.net/mailman/listinfo/py-dev">py-dev</a>
 mailing list.  I’d definitely like to pluginize more of pytest and add 
hooks as needed and am happy for feedback and suggestions before i 
freeze the API for 1.0.</p>
<p>holger</p>
	</div>

	<div class="meta group">
		<div class="signature">
			<p>Written by holger krekel <span class="edit"></span></p>
			<p>February 27, 2009 at 11:22 am</p>
		</div>
		<div class="tags">
			<p>Posted in <a href="http://holgerkrekel.net/category/metaprogramming/" rel="category tag">metaprogramming</a>, <a href="http://holgerkrekel.net/category/testing/" rel="category tag">testing</a></p>
					</div>
	</div>
</div>
<div class="post-20 post type-post status-publish format-standard hentry category-metaprogramming category-testing">
	<h2 id="post-20"><a href="http://holgerkrekel.net/2009/02/22/new-way-to-organize-python-test-code/" rel="bookmark">New way to organize Python test&nbsp;code</a></h2>
			<p class="comments"><a href="http://holgerkrekel.net/2009/02/22/new-way-to-organize-python-test-code/#comments">with 2 comments</a></p>
	
	<div class="main">
		<p><a class="reference external" href="http://pytest.org/">py.test</a>
 just grew a new way to provide test state for a test function.  First 
the problem: those of us dealing with writing tests in the hundreds or 
thousands usually setup test state at class, method or module level. 
Then we access it indirectly, through <cite>self</cite>, local or global
 helper functions.  For larger applications, this usually leads to 
scattered, complex and boilerplatisch test code.  This then stands in 
the way of refactoring the original code base … but wait, weren’t tests 
meant to ease refactoring, not hinder it?</p>
<p>Here is the idea: Python Test functions use their function definition
 to state their needs and the test tools calls a function that provides 
the value.  For example, consider this test function:</p>
<pre>
   def test_ospath(self, tempdir):
      # needs tempdir to create files etc.

</pre>
<pre>.
</pre>
<p><a class="reference external" href="http://pytest.org/">py.test</a> provides the value for <cite>tempdir</cite> by calling a matching method that looks like this:</p>
<pre>
  def pytest_pyfuncarg_tempdir(pyfuncitem):
      # use pyfuncitem to access test context, cmdline opts etc.

</pre>
<pre>.
</pre>
<p>This matching provider function returns a value for <cite>tempdir</cite> that is then supplied to the test function.  For more complex purposes,  the <cite>pyfuncitem</cite>
  argument provides full access to the test collection process including
 cmdline options, test options, project specific configuration.  You can
 write down this provider method in the test<br>
module, in configuration files or in a plugin.</p>
<p>Once i started using this new paradigm, i couldn’t resist and 
refactored pytest’s own tests to use the new method everywhere.  Here 
are my findings so far:</p>
<ul class="simple">
<li><strong>self contained test functions</strong>: i don’t need to wade through unneccessary layers and indirection of test setup.</li>
<li><strong>fewer imports</strong>: my test modules don’t need to import modules that are only needed for setting up application state.</li>
<li><strong>easy test state setup</strong>: I can place test support code in one place and i can grep for <cite>pytest_pyfuncarg_NAME</cite>.
  I can reuse this setup code easily across modules, directories or even
 projects.  Think about providing test database object or mocking 
objects.</li>
<li><strong>more flexible test grouping</strong>: I can logically group 
tests however i like, independently from test setup requirements.  I 
found it very easy to shuffle test functions between classes or modules 
because they are rather self-contained.</li>
</ul>
	</div>

	<div class="meta group">
		<div class="signature">
			<p>Written by holger krekel <span class="edit"></span></p>
			<p>February 22, 2009 at 5:23 pm</p>
		</div>
		<div class="tags">
			<p>Posted in <a href="http://holgerkrekel.net/category/metaprogramming/" rel="category tag">metaprogramming</a>, <a href="http://holgerkrekel.net/category/testing/" rel="category tag">testing</a></p>
					</div>
	</div>
</div>

<div class="navigation group">
	<div class="alignleft"></div>
	<div class="alignright"><a href="http://holgerkrekel.net/category/metaprogramming/page/3/">Newer Entries »</a></div>
</div>

</div>

<div id="sidebar">
<div style="overflow:hidden;"><a href="http://holgerkrekel.net/about-me/"><img src="metaprogramming-page4-mar9-2009_files/holger8b.jpg" class="alignnone" height="193" width="255"></a></div>
			<div class="textwidget"><div><a href="http://holgerkrekel.net/about-me/">about holger krekel</a></div>
<div><a href="http://holgerkrekel.net/feed/">Posts RSS Feed</a></div>
 <div><a href="http://holgerkrekel.net/comments/feed/">Comments RSS Feed</a></div>
</div>
		<h3><label for="subscribe-field">Follow Blog via Email</label></h3>
				<form action="https://subscribe.wordpress.com" method="post" accept-charset="utf-8" id="subscribe-blog">
											<p>Subscribe for posts by Email</p>
						<p><input name="email" style="width: 95%; padding: 1px 2px" placeholder="Enter your email address" id="subscribe-field" type="text"></p>
					
					<p>
						<input name="action" value="subscribe" type="hidden">
						<input name="blog_id" value="6679328" type="hidden">
						<input name="source" value="http://holgerkrekel.net/category/metaprogramming/page/4/" type="hidden">
						<input name="sub-type" value="widget" type="hidden">
						<input name="redirect_fragment" value="blog_subscription-3" type="hidden">
						<input id="_wpnonce" name="_wpnonce" value="8367ce2497" type="hidden">						<input value="Follow" type="submit">
					</p>
				</form>
			
<h3><a href="http://twitter.com/hpk42">hpk42 on Twitter</a></h3><ul class="tweets">
			<li>
				Didn't know that Australian gov is now trying to control mathematics, crypto research, disclosure of vulnerabilities <a href="http://www.smh.com.au/it-pro/security-it/dangerous-minds-are-maths-teachers-australias-newest-threat-20150608-ghira9"> smh.com.au/it-pro/securit…</a> 				<a href="http://twitter.com/hpk42/statuses/607871209812979712" class="timesince">14&nbsp;hours&nbsp;ago</a>
			</li>

			
			<li>
				RT @<a href="http://twitter.com/benborges_">benborges_</a>: David Graeber and the Bureaucratic Utopia of Drone Warfare <a href="http://bit.ly/1MyvMv0"> bit.ly/1MyvMv0</a> <a href="http://t.co/0aNsLVRPQC" rel="nofollow">http://t.co/0aNsLVRPQC</a> 				<a href="http://twitter.com/hpk42/statuses/607869382514102273" class="timesince">14&nbsp;hours&nbsp;ago</a>
			</li>

			
			<li>
				The images of the G7 "world leader" meeting at castle Elmau could 
have been produced cheaper in Hollywood or Babelsberg or Photoshop. 				<a href="http://twitter.com/hpk42/statuses/607848686484357120" class="timesince">15&nbsp;hours&nbsp;ago</a>
			</li>

			</ul><iframe style="position: static; visibility: visible; width: 106px; height: 20px;" data-twttr-rendered="true" title="Twitter Follow Button" class="twitter-follow-button twitter-follow-button" src="metaprogramming-page4-mar9-2009_files/follow_button.html" allowtransparency="true" scrolling="no" id="twitter-widget-0" frameborder="0"></iframe><h3>Recent Comments</h3>				<table class="recentcommentsavatar" border="0" cellpadding="0" cellspacing="0">
					<tbody><tr><td title="graffic" class="recentcommentsavatartop" style="height:48px; width:48px;"><a href="http://javier.gr/" rel="nofollow"><img id="grav-3b3bf952736e9178b464831d6675f6ac-0" alt="" src="metaprogramming-page4-mar9-2009_files/3b3bf952736e9178b464831d6675f6ac.jpg" class="avatar avatar-48 grav-hashed" height="48" width="48"></a></td><td class="recentcommentstexttop" style=""><a href="http://javier.gr/" rel="nofollow">graffic</a> on <a href="http://holgerkrekel.net/2015/04/09/going-beyond-codes-of-conduct/#comment-2977">Going beyond codes of&nbsp;con…</a></td></tr><tr><td title="Going beyond codes of conduct | metaprogramming and politics" class="recentcommentsavatarend" style="height:48px; width:48px;"><a href="http://holgerkrekel.net/2015/04/09/going-beyond-codes-of-conduct/" rel="nofollow"><img alt="" src="metaprogramming-page4-mar9-2009_files/b3a31bdc09d8a9d15ba87f69d34ece75.png" class="avatar avatar-48" height="48" width="48"></a></td><td class="recentcommentstextend" style=""><a href="http://holgerkrekel.net/2015/04/09/going-beyond-codes-of-conduct/" rel="nofollow">Going beyond codes o…</a> on <a href="http://holgerkrekel.net/2012/12/14/traditional-family-models-in-the-it-and-python-world/#comment-2974">Traditional family models in t…</a></td></tr><tr><td title="holger krekel" class="recentcommentsavatarend" style="height:48px; width:48px;"><a href="http://merlinux.eu/" rel="nofollow"><img id="grav-1d40af73bd088f5f7b487b42b799881d-0" alt="" src="metaprogramming-page4-mar9-2009_files/1d40af73bd088f5f7b487b42b799881d.jpg" class="avatar avatar-48 grav-hashed" height="48" width="48"></a></td><td class="recentcommentstextend" style=""><a href="http://merlinux.eu/" rel="nofollow">holger krekel</a> on <a href="http://holgerkrekel.net/2015/01/24/thoughts-on-arguing-end-to-end-crypto-and-surveillance/#comment-2766">Thoughts on arguing end-to-end…</a></td></tr><tr><td title="Harry P" class="recentcommentsavatarend" style="height:48px; width:48px;"><img id="grav-03671a05389885dc096868846a08c5f8-0" alt="" src="metaprogramming-page4-mar9-2009_files/03671a05389885dc096868846a08c5f8.png" class="avatar avatar-48 grav-hashed grav-hijack" height="48" width="48"></td><td class="recentcommentstextend" style="">Harry P on <a href="http://holgerkrekel.net/2015/01/24/thoughts-on-arguing-end-to-end-crypto-and-surveillance/#comment-2760">Thoughts on arguing end-to-end…</a></td></tr><tr><td title="Harry P" class="recentcommentsavatarend" style="height:48px; width:48px;"><img id="grav-03671a05389885dc096868846a08c5f8-1" alt="" src="metaprogramming-page4-mar9-2009_files/03671a05389885dc096868846a08c5f8.png" class="avatar avatar-48 grav-hashed grav-hijack" height="48" width="48"></td><td class="recentcommentstextend" style="">Harry P on <a href="http://holgerkrekel.net/2015/01/24/thoughts-on-arguing-end-to-end-crypto-and-surveillance/#comment-2759">Thoughts on arguing end-to-end…</a></td></tr>				</tbody></table>
								<h3>Recent Posts</h3>		<ul>
					<li>
				<a href="http://holgerkrekel.net/2015/04/09/going-beyond-codes-of-conduct/">Going beyond codes of&nbsp;conduct</a>
						</li>
					<li>
				<a href="http://holgerkrekel.net/2015/02/27/pytest-development-reorganization-adopt-pytest-month/">pytest development reorganization, adopt pytest&nbsp;month!</a>
						</li>
					<li>
				<a href="http://holgerkrekel.net/2015/01/24/thoughts-on-arguing-end-to-end-crypto-and-surveillance/">Thoughts on arguing end-to-end crypto and&nbsp;surveillance</a>
						</li>
					<li>
				<a href="http://holgerkrekel.net/2013/11/12/running-tests-against-multiple-devicesresources-in-parallel/">Running tests against multiple devices/resources (in&nbsp;parallel)</a>
						</li>
					<li>
				<a href="http://holgerkrekel.net/2013/10/26/defating-sauron-with-the-trust-on-first-use-principle/">Defeating Sauron with the “Trust on first use”&nbsp;principle</a>
						</li>
				</ul>
		<form role="search" method="get" id="searchform" class="searchform" action="http://holgerkrekel.net/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input name="s" id="s" type="text">
					<input id="searchsubmit" value="Search" type="submit">
				</div>
			</form><h3>Archives</h3>		<ul>
	<li><a href="http://holgerkrekel.net/2015/04/">April 2015</a></li>
	<li><a href="http://holgerkrekel.net/2015/02/">February 2015</a></li>
	<li><a href="http://holgerkrekel.net/2015/01/">January 2015</a></li>
	<li><a href="http://holgerkrekel.net/2013/11/">November 2013</a></li>
	<li><a href="http://holgerkrekel.net/2013/10/">October 2013</a></li>
	<li><a href="http://holgerkrekel.net/2013/05/">May 2013</a></li>
	<li><a href="http://holgerkrekel.net/2013/03/">March 2013</a></li>
	<li><a href="http://holgerkrekel.net/2012/12/">December 2012</a></li>
	<li><a href="http://holgerkrekel.net/2012/11/">November 2012</a></li>
	<li><a href="http://holgerkrekel.net/2010/12/">December 2010</a></li>
	<li><a href="http://holgerkrekel.net/2010/02/">February 2010</a></li>
	<li><a href="http://holgerkrekel.net/2009/09/">September 2009</a></li>
	<li><a href="http://holgerkrekel.net/2009/08/">August 2009</a></li>
	<li><a href="http://holgerkrekel.net/2009/05/">May 2009</a></li>
	<li><a href="http://holgerkrekel.net/2009/04/">April 2009</a></li>
	<li><a href="http://holgerkrekel.net/2009/03/">March 2009</a></li>
	<li><a href="http://holgerkrekel.net/2009/02/">February 2009</a></li>
		</ul>


</div>

</div>

<div id="footer">
	<p><a href="https://wordpress.com/?ref=footer_blog">Blog at WordPress.com</a>. <a href="https://wordpress.com/themes/journalist/" title="Learn more about this theme">The Journalist v1.9 Theme</a>.</p>
</div>
		<script type="text/javascript">
		//<![CDATA[
		var infiniteScroll = {"settings":{"id":"content","ajaxurl":"http:\/\/holgerkrekel.net\/?infinity=scrolling","type":"scroll","wrapper":true,"wrapper_class":"infinite-wrap","footer":true,"click_handle":"1","text":"Older posts","totop":"Scroll back to top","currentday":"22.02.09","order":"DESC","scripts":[],"styles":[],"google_analytics":false,"offset":4,"history":{"host":"holgerkrekel.net","path":"\/category\/metaprogramming\/page\/%d\/","use_trailing_slashes":true,"parameters":""},"query_args":{"paged":4,"category_name":"metaprogramming","error":"","m":"","p":0,"post_parent":"","subpost":"","subpost_id":"","attachment":"","attachment_id":0,"name":"","static":"","pagename":"","page_id":0,"second":"","minute":"","hour":"","day":0,"monthnum":0,"year":0,"w":0,"tag":"","cat":36279,"tag_id":"","author":"","author_name":"","feed":"","tb":"","comments_popup":"","meta_key":"","meta_value":"","preview":"","s":"","sentence":"","fields":"","menu_order":"","category__in":[],"category__not_in":[],"category__and":[],"post__in":[],"post__not_in":[],"tag__in":[],"tag__not_in":[],"tag__and":[],"tag_slug__in":[],"tag_slug__and":[],"post_parent__in":[],"post_parent__not_in":[],"author__in":[],"author__not_in":[],"posts_per_page":7,"ignore_sticky_posts":false,"suppress_filters":false,"cache_results":false,"update_post_term_cache":true,"update_post_meta_cache":true,"post_type":"","nopaging":false,"comments_per_page":"20","no_found_rows":false,"order":"DESC"},"last_post_date":"2009-02-22 17:23:57","stats":"blog=6679328&v=wpcom&tz=-1&user_id=0&subd=tetamap&x_pagetype=infinite"}};
		//]]>
		</script>
		<!-- wpcom_wp_footer -->
<script type="text/javascript" src="metaprogramming-page4-mar9-2009_files/gprofiles.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type="text/javascript" src="metaprogramming-page4-mar9-2009_files/wpgroho.js"></script>

	<script>
		//initialize and attach hovercards to all gravatars
		jQuery( document ).ready( function( $ ) {

			if (typeof Gravatar === "undefined"){
				return;
			}

			if ( typeof Gravatar.init !== "function" ) {
				return;
			}			

			Gravatar.profile_cb = function( hash, id ) {
				WPGroHo.syncProfileData( hash, id );
			};
			Gravatar.my_hash = WPGroHo.my_hash;
			Gravatar.init( 'body', '#wp-admin-bar-my-account' );
		});
	</script>

		<div style="display:none">
	<div class="grofile-hash-map-3b3bf952736e9178b464831d6675f6ac">
	</div>
	<div class="grofile-hash-map-1d40af73bd088f5f7b487b42b799881d">
	</div>
	<div class="grofile-hash-map-03671a05389885dc096868846a08c5f8">
	</div>
	</div>
		<div style="bottom: 0px;" id="infinite-footer">
			<div class="container">
				<div class="blog-info">
					<a title="Scroll back to top" id="infinity-blog-title" href="http://holgerkrekel.net/" rel="home">
						metaprogramming and politics					</a>
				</div>
				<div class="blog-credits">
					<a href="https://wordpress.com/?ref=footer_blog">Blog at WordPress.com</a>. <a href="https://wordpress.com/themes/journalist/" title="Learn more about this theme">The Journalist v1.9 Theme</a>.				</div>
			</div>
		</div><!-- #infinite-footer -->
		
	<div style="bottom: -276px;" id="bit" class="loggedout-follow-normal">
		<a class="bsub" href="javascript:void(0)"><span id="bsub-text">Follow</span></a>
		<div id="bitsubscribe">

					<h3><label for="loggedout-follow-field">Follow “metaprogramming and politics”</label></h3>

			<form action="https://subscribe.wordpress.com" method="post" accept-charset="utf-8" id="loggedout-follow">
			<p>Get every new post delivered to your Inbox.</p>

			<p id="loggedout-follow-error" style="display: none;"></p>

			
			<p><input name="email" value="Enter your email address" onfocus='this.value=(this.value=="Enter your email address") ? "" : this.value;' onblur='this.value=(this.value=="") ? "Enter your email address" : this.value;' id="loggedout-follow-field" type="email"></p>

			<input name="action" value="subscribe" type="hidden">
			<input name="blog_id" value="6679328" type="hidden">
			<input name="source" value="http://holgerkrekel.net/category/metaprogramming/page/4/" type="hidden">
			<input name="sub-type" value="loggedout-follow" type="hidden">

			<input id="_wpnonce" name="_wpnonce" value="8367ce2497" type="hidden"><input name="_wp_http_referer" value="/category/metaprogramming/page/4/" type="hidden">
			<p id="bsub-subscribe-button"><input value="Sign me up" type="submit"></p>
			</form>
					<div id="bsub-credit"><a href="https://wordpress.com/?ref=lof">Build a website with WordPress.com</a></div>
		</div><!-- #bitsubscribe -->
	</div><!-- #bit -->

	<div id="carousel-reblog-box">
		<form action="" name="carousel-reblog">
			<textarea id="carousel-reblog-content" name="carousel-reblog-content" onclick="if ( this.value == 'Add your thoughts here... (optional)' ) { this.value = ''; }" onblur="if ( this.value == '' || this.value == '' ) { this.value = 'Add your thoughts here... (optional)'; }">Add your thoughts here... (optional)</textarea>
			<label for="carousel-reblog-to-blog-id" id="carousel-reblog-lblogid">Post to</label>
			<select name="carousel-reblog-to-blog-id" id="carousel-reblog-to-blog-id">
						</select>

			<div class="submit">
				<span class="canceltext"><a href="" class="cancel">Cancel</a></span>
				<input name="carousel-reblog-submit" class="button" id="carousel-reblog-submit" value="Reblog Post" type="submit">
				<input id="carousel-reblog-blog-id" value="6679328" type="hidden">
				<input id="carousel-reblog-blog-url" value="http://holgerkrekel.net" type="hidden">
				<input id="carousel-reblog-blog-title" value="metaprogramming and politics" type="hidden">
				<input id="carousel-reblog-post-url" value="" type="hidden">
				<input id="carousel-reblog-post-title" value="" type="hidden">
			</div>

			<input id="_wpnonce" name="_wpnonce" value="dc474962cc" type="hidden"><input name="_wp_http_referer" value="/category/metaprogramming/page/4/" type="hidden">		</form>

		<div class="arrow"></div>
	</div>
<script type="text/javascript" src="metaprogramming-page4-mar9-2009_files/a_004"></script>
<script type="text/javascript">
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://s0.wp.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?m=1422342134g&amp;ver=3.0.9b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://s0.wp.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?m=1363304414g&amp;ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();
</script>
<link rel="stylesheet" id="all-css-0" href="metaprogramming-page4-mar9-2009_files/jetpack-carousel.css" type="text/css" media="all">
<!--[if lte IE 8]>
<link rel='stylesheet' id='jetpack-carousel-ie8fix-css'  href='http://s1.wp.com/wp-content/mu-plugins/carousel/jetpack-carousel-ie8fix.css?m=1412618825g&#038;ver=20121024' type='text/css' media='all' />
<![endif]-->
<link rel="stylesheet" id="all-css-2" href="metaprogramming-page4-mar9-2009_files/tiled-gallery.css" type="text/css" media="all">
<script type="text/javascript">
/* <![CDATA[ */
var JetpackEmojiSettings = {"base_url":"http:\/\/s0.wp.com\/wp-content\/mu-plugins\/emoji\/twemoji\/"};
/* ]]> */
</script>
<script type="text/javascript">
/* <![CDATA[ */
var jetpackCarouselStrings = {"widths":[370,700,1000,1200,1400,2000],"is_logged_in":"","lang":"en","ajaxurl":"http:\/\/holgerkrekel.net\/wp-admin\/admin-ajax.php","nonce":"382dd0ea30","display_exif":"1","display_geo":"1","background_color":"black","comment":"Comment","post_comment":"Post Comment","write_comment":"Write a Comment...","loading_comments":"Loading Comments...","download_original":"View full size <span class=\"photo-size\">{0}<span class=\"photo-size-times\">\u00d7<\/span>{1}<\/span>","no_comment_text":"Please be sure to submit some text with your comment.","no_comment_email":"Please provide an email address to comment.","no_comment_author":"Please provide your name to comment.","comment_post_error":"Sorry, but there was an error posting your comment. Please try again later.","comment_approved":"Your comment was approved.","comment_unapproved":"Your comment is in moderation.","camera":"Camera","aperture":"Aperture","shutter_speed":"Shutter Speed","focal_length":"Focal Length","comment_registration":"0","require_name_email":"1","login_url":"https:\/\/tetamap.wordpress.com\/wp-login.php?redirect_to=http%3A%2F%2Fholgerkrekel.net%2F2009%2F02%2F22%2Fnew-way-to-organize-python-test-code%2F","local_comments_commenting_as":"<fieldset><label for=\"email\">Email (Required)<\/label> <input type=\"text\" name=\"email\" class=\"jp-carousel-comment-form-field jp-carousel-comment-form-text-field\" id=\"jp-carousel-comment-form-email-field\" \/><\/fieldset><fieldset><label for=\"author\">Name (Required)<\/label> <input type=\"text\" name=\"author\" class=\"jp-carousel-comment-form-field jp-carousel-comment-form-text-field\" id=\"jp-carousel-comment-form-author-field\" \/><\/fieldset><fieldset><label for=\"url\">Website<\/label> <input type=\"text\" name=\"url\" class=\"jp-carousel-comment-form-field jp-carousel-comment-form-text-field\" id=\"jp-carousel-comment-form-url-field\" \/><\/fieldset>","reblog":"Reblog","reblogged":"Reblogged","reblog_add_thoughts":"Add your thoughts here... (optional)","reblogging":"Reblogging...","post_reblog":"Post Reblog","stats_query_args":"blog=6679328&v=wpcom&tz=-1&user_id=0&subd=tetamap","is_public":"1"};
var jetpackCarouselStrings = {"widths":[370,700,1000,1200,1400,2000],"is_logged_in":"","lang":"en","ajaxurl":"http:\/\/holgerkrekel.net\/wp-admin\/admin-ajax.php","nonce":"382dd0ea30","display_exif":"1","display_geo":"1","background_color":"black","comment":"Comment","post_comment":"Post Comment","write_comment":"Write a Comment...","loading_comments":"Loading Comments...","download_original":"View full size <span class=\"photo-size\">{0}<span class=\"photo-size-times\">\u00d7<\/span>{1}<\/span>","no_comment_text":"Please be sure to submit some text with your comment.","no_comment_email":"Please provide an email address to comment.","no_comment_author":"Please provide your name to comment.","comment_post_error":"Sorry, but there was an error posting your comment. Please try again later.","comment_approved":"Your comment was approved.","comment_unapproved":"Your comment is in moderation.","camera":"Camera","aperture":"Aperture","shutter_speed":"Shutter Speed","focal_length":"Focal Length","comment_registration":"0","require_name_email":"1","login_url":"https:\/\/tetamap.wordpress.com\/wp-login.php?redirect_to=http%3A%2F%2Fholgerkrekel.net%2F2009%2F02%2F22%2Fnew-way-to-organize-python-test-code%2F","local_comments_commenting_as":"<fieldset><label for=\"email\">Email (Required)<\/label> <input type=\"text\" name=\"email\" class=\"jp-carousel-comment-form-field jp-carousel-comment-form-text-field\" id=\"jp-carousel-comment-form-email-field\" \/><\/fieldset><fieldset><label for=\"author\">Name (Required)<\/label> <input type=\"text\" name=\"author\" class=\"jp-carousel-comment-form-field jp-carousel-comment-form-text-field\" id=\"jp-carousel-comment-form-author-field\" \/><\/fieldset><fieldset><label for=\"url\">Website<\/label> <input type=\"text\" name=\"url\" class=\"jp-carousel-comment-form-field jp-carousel-comment-form-text-field\" id=\"jp-carousel-comment-form-url-field\" \/><\/fieldset>","reblog":"Reblog","reblogged":"Reblogged","reblog_add_thoughts":"Add your thoughts here... (optional)","reblogging":"Reblogging...","post_reblog":"Post Reblog","stats_query_args":"blog=6679328&v=wpcom&tz=-1&user_id=0&subd=tetamap","is_public":"1"};
/* ]]> */
</script>
<script type="text/javascript" src="metaprogramming-page4-mar9-2009_files/a"></script>
<script type="text/javascript" src="metaprogramming-page4-mar9-2009_files/widgets.js"></script>
<script type="text/javascript" src="metaprogramming-page4-mar9-2009_files/a_003"></script>
<script type="text/javascript">
// <![CDATA[
(function() {
try{
  if ( window.external &&'msIsSiteMode' in window.external) {
    if (window.external.msIsSiteMode()) {
      var jl = document.createElement('script');
      jl.type='text/javascript';
      jl.async=true;
      jl.src='/wp-content/plugins/ie-sitemode/custom-jumplist.php';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jl, s);
    }
  }
}catch(e){}
})();
// ]]>
</script><script type="text/javascript">
			jQuery.extend( infiniteScroll.settings.scripts, ["jquery","jquery-core","jquery-migrate","mobile-useragent-info","postmessage","jquery_inview","jetpack_resize","loggedout-subscribe","spin","jquery.spin","grofiles-cards","wpgroho","syntaxhighlighter-core","syntaxhighlighter-brush-python","devicepx","the-neverending-homepage","twemoji","jetpack-emoji","jetpack-emoji-init","swfobject","videopress","jetpack-carousel","twitter-widgets","twitter-widgets-infinity","twitter-widgets-pending","tiled-gallery"] );
			jQuery.extend( infiniteScroll.settings.styles, ["smileyproject","jetpack_likes","loggedout-subscribe","the-neverending-homepage","journalist-infinite-scroll","wpcom-core-compat-playlist-styles","mp6hacks","wpcom-bbpress2-staff-css","journalist","jetpack-emoji-css","noticons","geo-location-flair","reblogging","a8c-global-print","h4-global","journalist-ie6","jetpack-carousel","tiled-gallery","jetpack-carousel-ie8fix"] );
		</script><script src="metaprogramming-page4-mar9-2009_files/w.js" type="text/javascript" async="" defer="defer"></script>
<script type="text/javascript">
_tkq = window._tkq || [];
_stq = window._stq || [];
_tkq.push(['storeContext', {'blog_id':'6679328','blog_tz':'-1','user_lang':'en','blog_lang':'en','user_id':'0'}]);
_stq.push(['view', {'blog':'6679328','v':'wpcom','tz':'-1','user_id':'0','subd':'tetamap'}]);
_stq.push(['extra', {'crypt':'UE40eW5QN0p8M2Y/RE1LVmwrVi5vQS5fVFtfdHBbPyw1VXIrU3hWLHhmcmw0bWUwNis5Vk1qSEpzeXBoR2E/dmFIcl9HLjd1TGgrJm9kalImVUZGNEZjYjVlR1gseHYlYnFFVFdTdUpvdHxQajZ+JU1PeS0/bVlUSks/SzRJQjZaW1lsQ2JoP0U3fFJCcitMdjJiR35mYWslOGs3a1A0bWtkRkpDTSU/X0NuMkRjSzhtZ242JWgmV0s0RyttSkN8UkJmWTJ5RURyeVUwRyVEej1KOWpuOC80OXgwYVNMMHB6YzI9fF9ZY3piKy5IdlYsPyt5UU81Zng3ZFRZW3ZbdkE0ViVmTnVzYkp6VkJJeEZlb1dLT05+TGMyMzdTY19ta0c4ajN3XzNYc1ZiekdNc2t5cV9RYnBIdDMldFQ0ayVzYVt2Ul1HODcuSm8waDJdaiVIU0RPLj1Rcj8sZkp5R2pSL1RR'}]);
_stq.push([ 'clickTrackerInit', '6679328', '0' ]);
	</script>
<noscript><img src="http://pixel.wp.com/b.gif?v=noscript" style="height:0px;width:0px;overflow:hidden" alt="" /></noscript>
<script>
if ( 'object' === typeof wpcom_mobile_user_agent_info ) {

	wpcom_mobile_user_agent_info.init();
	var mobileStatsQueryString = "";
	
	if( false !== wpcom_mobile_user_agent_info.matchedPlatformName )
		mobileStatsQueryString += "&x_" + 'mobile_platforms' + '=' + wpcom_mobile_user_agent_info.matchedPlatformName;
	
	if( false !== wpcom_mobile_user_agent_info.matchedUserAgentName )
		mobileStatsQueryString += "&x_" + 'mobile_devices' + '=' + wpcom_mobile_user_agent_info.matchedUserAgentName;
	
	if( wpcom_mobile_user_agent_info.isIPad() )
		mobileStatsQueryString += "&x_" + 'ipad_views' + '=' + 'views';

	if( "" != mobileStatsQueryString ) {
		new Image().src = document.location.protocol + '//pixel.wp.com/g.gif?v=wpcom-no-pv' + mobileStatsQueryString + '&baba=' + Math.random();
	}
	
}
</script>

<img id="wpstats" src="metaprogramming-page4-mar9-2009_files/g.gif"><a style="position: absolute; top: 1027px; left: 931px; z-index: 15; border: medium none; text-decoration: none;" href="http://gravatar.com/03671a05389885dc096868846a08c5f8" class="grav-clone-a" target="_blank"><img style="box-shadow: 0px 0px 4px rgba(0, 0, 0, 0.4); border-width: 2px 2px 9.6px; border-color: rgb(255, 255, 255); border-style: solid; padding: 0px; margin: -2px 0px 0px -2px;" id="grav-clone-03671a05389885dc096868846a08c5f8" alt="" src="metaprogramming-page4-mar9-2009_files/03671a05389885dc096868846a08c5f8.png" class="avatar avatar-48 grav-hijack grav-clone" height="48" width="48"></a></body></html>